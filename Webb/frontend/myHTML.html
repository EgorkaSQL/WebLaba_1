<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Handjet:wght@100..900&family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <style>
        body {
            font-family: 'Pixelify Sans', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #220737;
        }
        header {
            background-color: #3399ff;
            color: white;
            padding: 15px;
            text-align: center;
        }
        .container:hover { cursor: pointer; }
        .container:before { content: ""; }
        .container {
            display: flex;
            justify-content: center;
            padding: 20px;
        }
        .form-container {
            border: 1px solid #ccc;
            padding: 30px;
            width: 500px;
            background-color: #ffffff;
        }
        .form-container input[type="number"] {
            max-width: 50%;
        }
        .form-field {
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-bottom: 7px;
        }
        input, select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        input.error, select.error {
            border-bottom: 1px solid red;
        }
        .result-table {
            width: 500px;
            table-layout: fixed;
            word-wrap: break-word;
        }
        .result-table th, .result-table td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        .result-table th {
            background-color: #473a95;
            color: white;
        }
        .content-wrapper {
            display: flex;
            gap: 20px;
            background-color: #330e65;
            padding: 20px;
            border-radius: 8px;
        }
        canvas {
            background-color: white;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>

<header>
    <p>Студент: Кондилеев Егор Юрьевич | Группа: P3210 | Вариант: 488779</p>
</header>

<div class="container">
    <div class="content-wrapper">
        <div class="form-container">
            <form id="coordinates-form">
                <div class="form-field">
                    <label for="radius">Выберите радиус (R):</label>
                    <select id="radius" name="radius">
                        <option value="1">1</option>
                        <option value="1.5">1.5</option>
                        <option value="2">2</option>
                        <option value="2.5">2.5</option>
                        <option value="3">3</option>
                    </select>
                </div>
                <div class="form-field">
                    <label for="x-coord">Введите X координату (-3 ... 5):</label>
                    <input type="number" id="x-coord" name="x-coord" min="-3" max="5" required>
                </div>
                <div class="form-field">
                    <label for="y-coord">Введите Y координату (-R/2 ... R):</label>
                    <input type="number" id="y-coord" name="y-coord" min="-3" max="5" step="0.1" required>
                </div>
                <button type="submit">Отправить</button>
            </form>
            <table class="result-table" id="results">
                <thead>
                <tr>
                    <th>R</th>
                    <th>X</th>
                    <th>Y</th>
                    <th>Ответ</th>
                    <th>Текущее время</th>
                    <th>Время работы скрипта</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="canvas-container">
            <canvas id="coordinate-plane" width="400" height="400"></canvas>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('coordinate-plane');
    const ctx = canvas.getContext('2d');
    const canvasSize = 400;
    const halfCanvasSize = canvasSize / 2;
    const pixelRatio = canvasSize / 4;

    function drawStaticAreas() {
        ctx.fillStyle = 'rgba(0, 0, 255, 0.5)';

        // Четверть окружности
        ctx.beginPath();
        ctx.arc(halfCanvasSize, halfCanvasSize, 1 * pixelRatio, -Math.PI / 2, 0, false);
        ctx.lineTo(halfCanvasSize, halfCanvasSize);
        ctx.closePath();
        ctx.fill();

        // Треугольник
        ctx.beginPath();
        ctx.moveTo(halfCanvasSize, halfCanvasSize);
        ctx.lineTo(halfCanvasSize - 1 * pixelRatio, halfCanvasSize);
        ctx.lineTo(halfCanvasSize, halfCanvasSize - 2 * pixelRatio);
        ctx.closePath();
        ctx.fill();

        // Прямоугольник
        ctx.fillRect(halfCanvasSize - 1 * pixelRatio, halfCanvasSize, 1 * pixelRatio, 2 * pixelRatio);
    }

    function drawAxes() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        ctx.beginPath();
        ctx.moveTo(0, halfCanvasSize);
        ctx.lineTo(canvasSize, halfCanvasSize);  // Ось X
        ctx.moveTo(halfCanvasSize, 0);
        ctx.lineTo(halfCanvasSize, canvasSize);  // Ось Y
        ctx.strokeStyle = 'black';
        ctx.stroke();

        ctx.fillStyle = 'black';
        ctx.font = '12px Arial';
        ctx.fillText('X', canvasSize - 10, halfCanvasSize + 15);
        ctx.fillText('Y', halfCanvasSize - 10, 10);

        const labels = ['-R', '-R/2', 'R/2', 'R'];
        const positions = [-2, -1, 1, 2];

        positions.forEach((pos, i) => {
            ctx.fillText(labels[i], halfCanvasSize + pos * pixelRatio - 10, halfCanvasSize + 15);
        });

        positions.forEach((pos, i) => {
            ctx.fillText(labels[i], halfCanvasSize - 25, halfCanvasSize - pos * pixelRatio + 5);
        });
    }

    function plotPoint(x, y, r) {
        const scaledX = (x / r) * 2;
        const scaledY = (y / r) * 2;
        const canvasX = halfCanvasSize + scaledX * pixelRatio;
        const canvasY = halfCanvasSize - scaledY * pixelRatio;

        ctx.beginPath();
        ctx.arc(canvasX, canvasY, 5, 0, 2 * Math.PI);
        ctx.fillStyle = 'red';
        ctx.fill();
    }

    window.onload = function () {
        drawAxes();
        drawStaticAreas();
    };

    document.getElementById('coordinates-form').addEventListener('submit', function (event) {
    event.preventDefault();

    const r = parseFloat(document.getElementById('radius').value);
    const x = parseFloat(document.getElementById('x-coord').value);
    const y = parseFloat(document.getElementById('y-coord').value);

    // Отправка данных на сервер с помощью fetch
    fetch('/backend/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ r, x, y })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`Ошибка: ${response.statusText}`);
        }
        return response.json();
    })
    .then(data => {
    const resultRow = document.createElement('tr');
    resultRow.innerHTML = `
        <td>${r}</td>
        <td>${x}</td>
        <td>${y}</td>
        <td>${data.isInArea ? 'Да' : 'Нет'}</td>
        <td>${data.currentTime}</td>
        <td>${data.execTime} ms</td>
    `;
    document.querySelector('#results tbody').appendChild(resultRow);
    plotPoint(x, y, r);
})
    .catch(error => console.error('Ошибка:', error));
});
</script>
</body>
</html>